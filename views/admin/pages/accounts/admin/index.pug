extends ../../../layouts/default.pug

block main
  .admin-accounts-page
    // Page Header
    .page-header.mb-4
      h1.page-title.fade-in-up
        i.fas.fa-user-shield.me-3
        | Admin Accounts Management
      p.page-subtitle.text-muted.fade-in-up Manage and monitor admin user accounts
    
    // Action Bar
    .action-bar.mb-4
      .row.align-items-center
        .col-md-6
          .d-flex.align-items-center
            .search-box.me-3
              .input-group
                input.form-control(type="text", placeholder="Search admins...", name="search")
                button.btn.btn-outline-primary(type="button")
                  i.fas.fa-search
            .filter-dropdown
              select.form-select
                option(value="") All Roles
                option(value="super") Super Admin
                option(value="admin") Admin
                option(value="moderator") Moderator
        .col-md-6
          .d-flex.justify-content-end
            a.btn.btn-primary(href=`/${prefixAdmin}/accounts/admin/create`)
              i.fas.fa-plus.me-2
              | Add New Admin
    
    // Stats Cards
    .row.mb-4
      .col-xl-3.col-md-6.mb-3
        .stats-card.bg-gradient-primary
          .d-flex.justify-content-between.align-items-center
            .stats-content
              .stats-number #{admins ? admins.length : 0}
              .stats-label Total Admins
            .stats-icon
              i.fas.fa-user-shield
      
      .col-xl-3.col-md-6.mb-3
        .stats-card.bg-gradient-success
          .d-flex.justify-content-between.align-items-center
            .stats-content
              .stats-number #{admins ? admins.filter(admin => admin.status === 'active').length : 0}
              .stats-label Active Admins
            .stats-icon
              i.fas.fa-user-check
      
      .col-xl-3.col-md-6.mb-3
        .stats-card.bg-gradient-warning
          .d-flex.justify-content-between.align-items-center
            .stats-content
              .stats-number #{admins ? admins.filter(admin => admin.role_id === 'super').length : 0}
              .stats-label Super Admins
            .stats-icon
              i.fas.fa-crown
      
      .col-xl-3.col-md-6.mb-3
        .stats-card.bg-gradient-info
          .d-flex.justify-content-between.align-items-center
            .stats-content
              .stats-number #{admins ? admins.filter(admin => admin.lastLogin && new Date(admin.lastLogin) > new Date(Date.now() - 24*60*60*1000)).length : 0}
              .stats-label Online Today
            .stats-icon
              i.fas.fa-circle.text-success
    
    // Admins Table
    .card.table-container
      .card-header
        h5.mb-0
          i.fas.fa-users.me-2
          | Admin Accounts
        .card-header-actions
          .btn-group(role="group")
            button.btn.btn-outline-primary.btn-sm(type="button")
              i.fas.fa-download.me-1
              | Export
            button.btn.btn-outline-secondary.btn-sm(type="button")
              i.fas.fa-filter.me-1
              | Filter
      
      .card-body.p-0
        .table-responsive
          table.table.table-hover.mb-0
            thead
              tr
                th.text-center
                  input.form-check-input(type="checkbox", id="selectAll")
                th
                  i.fas.fa-user.me-1
                  | Admin
                th
                  i.fas.fa-shield-alt.me-1
                  | Role
                th
                  i.fas.fa-envelope.me-1
                  | Email
                th
                  i.fas.fa-phone.me-1
                  | Phone
                th
                  i.fas.fa-calendar.me-1
                  | Last Login
                th
                  i.fas.fa-circle.me-1
                  | Status
                th.text-center
                  i.fas.fa-cog.me-1
                  | Actions
            
            tbody
              if admins && admins.length > 0
                each admin, index in admins
                  tr
                    td.text-center
                      input.form-check-input(type="checkbox", name="adminIds", value=admin.id)
                    td
                      .d-flex.align-items-center
                        .avatar.me-3
                          img.rounded-circle(src=admin.avatar || "/src/user.jpeg", alt=admin.fullName, width="40", height="40")
                        .user-info
                          .user-name.fw-semibold #{admin.fullName}
                          .user-id.text-muted.small ID: #{admin.id}
                    td
                      .role-badge
                        if admin.role_id === 'super'
                          span.badge.bg-danger
                            i.fas.fa-crown.me-1
                            | Super Admin
                        else if admin.role_id === 'admin'
                          span.badge.bg-primary
                            i.fas.fa-user-shield.me-1
                            | Admin
                        else
                          span.badge.bg-secondary
                            i.fas.fa-user.me-1
                            | #{admin.role_id}
                    td
                      a.text-decoration-none(href=`mailto:${admin.email}`) #{admin.email}
                    td
                      if admin.phone
                        a.text-decoration-none(href=`tel:${admin.phone}`) #{admin.phone}
                      else
                        span.text-muted N/A
                    td
                      if admin.lastLogin
                        .last-login
                          .date #{new Date(admin.lastLogin).toLocaleDateString()}
                          .time.text-muted.small #{new Date(admin.lastLogin).toLocaleTimeString()}
                      else
                        span.text-muted Never
                    td
                      if admin.status === 'active'
                        span.badge.bg-success
                          i.fas.fa-check-circle.me-1
                          | Active
                      else
                        span.badge.bg-secondary
                          i.fas.fa-times-circle.me-1
                          | Inactive
                    td.text-center
                      .dropdown
                        button.btn.btn-sm.btn-outline-secondary.dropdown-toggle(type="button", data-bs-toggle="dropdown")
                          i.fas.fa-ellipsis-v
                        ul.dropdown-menu.dropdown-menu-end
                          li
                            a.dropdown-item(href=`/${prefixAdmin}/accounts/admin/view/${admin.id}`)
                              i.fas.fa-eye.me-2
                              | View Details
                          li
                            a.dropdown-item(href=`/${prefixAdmin}/accounts/admin/edit/${admin.id}`)
                              i.fas.fa-edit.me-2
                              | Edit
                          li
                            a.dropdown-item(href=`/${prefixAdmin}/accounts/admin/permissions/${admin.id}`)
                              i.fas.fa-key.me-2
                              | Permissions
                          li
                            hr.dropdown-divider
                          li
                            a.dropdown-item.text-danger(href="#", data-bs-toggle="modal", data-bs-target="#deleteModal", data-admin-id=admin.id, data-admin-name=admin.fullName)
                              i.fas.fa-trash.me-2
                              | Delete
              else
                tr
                  td.text-center.py-5(colspan="8")
                    .empty-state
                      i.fas.fa-users.fs-1.text-muted.mb-3
                      h5.text-muted No admin accounts found
                      p.text-muted Get started by adding your first admin account.
                      a.btn.btn-primary(href=`/${prefixAdmin}/accounts/admin/create`)
                        i.fas.fa-plus.me-2
                        | Add Admin Account
    
    // Pagination
    if admins && admins.length > 0
      .d-flex.justify-content-between.align-items-center.mt-4
        .pagination-info
          span.text-muted Showing 1 to #{admins.length} of #{admins.length} entries
        nav
          ul.pagination.pagination-sm.mb-0
            li.page-item.disabled
              a.page-link(href="#") Previous
            li.page-item.active
              a.page-link(href="#") 1
            li.page-item.disabled
              a.page-link(href="#") Next

  // Delete Confirmation Modal
  .modal.fade#deleteModal(tabindex="-1")
    .modal-dialog
      .modal-content
        .modal-header.bg-danger.text-white
          h5.modal-title
            i.fas.fa-exclamation-triangle.me-2
            | Confirm Deletion
          button.btn-close.btn-close-white(type="button", data-bs-dismiss="modal")
        .modal-body
          p Are you sure you want to delete admin account 
            strong#deleteAdminName
            | ? This action cannot be undone.
        .modal-footer
          button.btn.btn-secondary(type="button", data-bs-dismiss="modal") Cancel
          button.btn.btn-danger#confirmDelete
            i.fas.fa-trash.me-2
            | Delete Account

  script.
    // Delete confirmation
    document.getElementById('deleteModal').addEventListener('show.bs.modal', function (event) {
      const button = event.relatedTarget;
      const adminId = button.getAttribute('data-admin-id');
      const adminName = button.getAttribute('data-admin-name');
      
      document.getElementById('deleteAdminName').textContent = adminName;
      document.getElementById('confirmDelete').onclick = function() {
        // Add delete logic here
        window.location.href = `/${prefixAdmin}/accounts/admin/delete/${adminId}`;
      };
    });

    // Select all functionality
    document.getElementById('selectAll').addEventListener('change', function() {
      const checkboxes = document.querySelectorAll('input[name="adminIds"]');
      checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
      });
    });